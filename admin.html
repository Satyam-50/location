<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeoLink Admin - Live Tracking</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    
    <style>
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background-color: #0f172a; color: white; }
        
        /* LOGIN SCREEN DESIGN */
        #login-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #0f172a; z-index: 2000;
            display: flex; justify-content: center; align-items: center;
            flex-direction: column;
        }
        .login-box {
            background: #1e293b; padding: 2.5rem; border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); text-align: center; width: 320px;
            border: 1px solid #334155;
        }
        .login-box h2 { margin-top: 0; color: #3b82f6; }
        input {
            width: 100%; padding: 12px; margin: 10px 0; box-sizing: border-box;
            background: #334155; border: 1px solid #475569; color: white; border-radius: 8px;
            outline: none; font-size: 16px;
        }
        input:focus { border-color: #3b82f6; }
        button {
            width: 100%; padding: 12px; background: #3b82f6; color: white;
            border: none; border-radius: 8px; cursor: pointer; font-weight: bold;
            font-size: 16px; margin-top: 10px; transition: background 0.3s;
        }
        button:hover { background: #2563eb; }
        .error { color: #ef4444; font-size: 0.9rem; display: none; margin-top: 15px; }

        /* MAP & STATUS BAR */
        #map { height: 100vh; width: 100%; display: none; } 
        
        .status-bar {
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(15, 23, 42, 0.9); padding: 12px 25px; border-radius: 50px;
            z-index: 1000; display: none; box-shadow: 0 4px 20px rgba(0,0,0,0.4);
            border: 1px solid #334155; font-size: 14px; white-space: nowrap;
        }
        .live-dot {
            height: 12px; width: 12px; background-color: #22c55e;
            border-radius: 50%; display: inline-block; margin-right: 10px;
            box-shadow: 0 0 10px #22c55e; animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .last-seen { font-size: 12px; color: #94a3b8; margin-left: 10px; }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div class="login-box">
            <h2>üîê Admin Access</h2>
            <input type="email" id="email" placeholder="Admin Email">
            <input type="password" id="password" placeholder="Secret Password">
            <button onclick="checkLogin()">Unlock Dashboard</button>
            <p class="error" id="error-msg">‚ùå Access Denied! Wrong ID/Pass.</p>
        </div>
    </div>

    <div id="status-bar" class="status-bar">
        <span class="live-dot"></span> 
        <strong>Target: User-1</strong> 
        <span id="last-update" class="last-seen">Waiting for signal...</span>
    </div>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <script>
        // ====================================================
        // IMPORTANT: PASTE YOUR FIREBASE CONFIG HERE
        // ====================================================
        const firebaseConfig = {
                apiKey: "AIzaSyDJqe6EiXI5P1uVnZ3OFg0SEtGShn_XqtY",
                authDomain: "location-ebaa0.firebaseapp.com",
                databaseURL: "https://location-ebaa0-default-rtdb.firebaseio.com",
                projectId: "location-ebaa0",
                storageBucket: "location-ebaa0.firebasestorage.app",
                messagingSenderId: "912182793503",
                appId: "1:912182793503:web:87fac128cfdb148ac10c2a",
                measurementId: "G-BJ8CSTFLRH"
             };
        // ====================================================

        // Initialize Firebase
        try {
            firebase.initializeApp(firebaseConfig);
        } catch (e) {
            console.error("Firebase Config Error: Shayad tumne API Key paste nahi ki!", e);
        }
        const db = firebase.database();

        let map, marker;

        // Login Check Function
        function checkLogin() {
            const email = document.getElementById('email').value.trim();
            const pass = document.getElementById('password').value.trim();
            
            // TUMHARA SECRET LOGIN (Yahan change kar sakte ho)
            if(email === "admin@geolink.lock" && pass === "Satyam#Admin2026") {
                document.getElementById('login-overlay').style.display = 'none';
                document.getElementById('map').style.display = 'block';
                document.getElementById('status-bar').style.display = 'block';
                
                // Map ko load hone ka time do fir initialize karo
                setTimeout(initMap, 100);
            } else {
                document.getElementById('error-msg').style.display = 'block';
            }
        }

        // Map Start Function
        function initMap() {
            // India par focus karke map banao
            map = L.map('map').setView([22.8, 86.2], 10); 

            // Map Tiles (Sadak aur raste dikhane ke liye)
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);

            // Ek marker banao (Jo move karega)
            marker = L.marker([0, 0]).addTo(map);

            startTracking();
        }

        // Real-time Tracking Function
        function startTracking() {
            const statusText = document.getElementById('last-update');
            
            // Database se 'locations/target_user' path ko suno
            db.ref('locations/target_user').on('value', (snapshot) => {
                const data = snapshot.val();
                
                if (data) {
                    const { lat, lng, last_update } = data;
                    
                    // Marker ki nayi jagah set karo
                    marker.setLatLng([lat, lng]);
                    
                    // Map ka camera wahan le jao (Smooth Animation)
                    map.flyTo([lat, lng], 16, {
                        animate: true,
                        duration: 1.5
                    });

                    // Update Time dikhao
                    if(last_update) {
                        const date = new Date(last_update);
                        statusText.innerText = "Updated: " + date.toLocaleTimeString();
                    } else {
                        statusText.innerText = "Live Signal Recieved";
                    }

                    console.log("New Location:", lat, lng);
                }
            }, (error) => {
                console.error("Data loading error:", error);
                alert("Database access denied! Check Console.");
            });
        }
    </script>
</body>
</html>